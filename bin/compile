#!/bin/bash

env_dir=$3
echo "-----> exporting env"
blacklist_regex=${3:-'^(PATH|GIT_DIR|CPATH|CPPATH|LD_PRELOAD|LIBRARY_PATH)$'}
for e in $(ls $env_dir); do
  echo "$e" | grep -qvE "$blacklist_regex" &&
  export "$e=$(cat $env_dir/$e)"
  :
done

echo "-----> Precompiling assets..."

cd $1
SKIP_CORPUS=1 bundle exec rake assets:precompile

echo "-----> Assets precompiled!"
echo "-----> Deleting app/assets to reduce slug size"
rm -rf app/assets/
