#!/bin/bash

#BUILD_DIR=$1
#CACHE_DIR=$2
#ENV_DIR=$3

echo '***'
echo $1
echo $2
echo $3
echo '***'

env_dir=$3
echo "-----> exporting env from $env_dir"
whitelist_regex=${2:-''}
blacklist_regex=${3:-'^(PATH|GIT_DIR|CPATH|CPPATH|LD_PRELOAD|LIBRARY_PATH)$'}
for e in $(ls $env_dir); do
  echo "$e" | grep -qvE "$blacklist_regex" &&
  echo $e
  :
  echo "$e" | grep -qvE "$blacklist_regex" &&
  export "$e=$(cat $env_dir/$e)"
  :
done

echo "-----> Precompiling assets..."

cd $1
SKIP_CORPUS=1 ACTIVEADMIN=enabled bundle exec rake assets:precompile

echo "-----> Assets precompiled!"
